Windowsで指定したリストファイルを読込、そのファイルに記載されていないファイル名以外のファイルをカレントディレクトリ配下から再帰的に探し出して削除する、その後、カレントディレクトリから再帰的に空のフォルダを探し出して削除するバッチファイルを出力してください


下記のバッチファイルは、指定したリストファイルに記載されていないファイルを再帰的に検索し削除し、その後空のディレクトリを検索し削除するスクリプトです。このバッチファイルを実行する前に、必ずバックアップを取るなどして、予期しないデータ損失を避けてください。

```batch
@echo off
setlocal enabledelayedexpansion

:: リストファイル名をsetする（ファイルパスも適宜指定）
set LISTFILE=keepfiles.txt

:: カレントディレクトリからリストにないファイルを削除
for /r %%i in (*) do (
 set FILE=%%~nxi
 set KEEP=false
 for /f "tokens=*" %%j in (%LISTFILE%) do (
 if "%%~nxi"=="%%j" set KEEP=true
 )
 if not !KEEP! == true (
 echo Deleting: %%i
 del "%%i"
 )
)

:: 空のディレクトリを削除
for /d /r %%i in (*) do (
 dir /b "%%i" | findstr "^" >nul || (
 echo Removing empty directory: %%i
 rmdir "%%i"
 )
)

echo Finished.
endlocal
pause
```

バッチファイルの使い方：

1. `keepfiles.txt` という名前のリストファイルを用意し、カレントディレクトリに置くか、適切なパスを `set LISTFILE=keepfiles.txt` の行に設定してください。
2. リストファイルには、削除しないファイル名（拡張子込み）を行ごとに記載します。
3. このバッチファイルを保存し、実行するディレクトリで実行します。
4. スクリプトはまず、カレントディレクトリとそのサブディレクトリ内のすべてのファイルをスキャンし、リストファイルに記載されていないファイルを削除します。
5. その後、空のディレクトリを探して削除します。

注意事項：
- 実行前には十分なテストを行い、データのバックアップを取ることを強く推奨します。
- このスクリプトは非常に危険な操作を行います。削除操作は取り返しがつかないため、実行は自己責任でお願いします。
- リストファイル内のファイル名は大文字小文字を区別しないものとして比較されます。また、完全なファイル名のみが対象となります（パスは含みません）。必要に応じてスクリプトを調整してください。
