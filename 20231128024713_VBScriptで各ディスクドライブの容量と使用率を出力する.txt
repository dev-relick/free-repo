VBScriptで各ディスクドライブの容量と使用率を出力する


下記のVBScriptコードでは、コンピュータ上の各ディスクドライブの容量と空き容量を取得し、その情報を使用して使用率も計算して出力します。コードをテキストファイルにコピーし、拡張子を `.vbs` に変更して保存し、その後スクリプトを実行することができます。

```VBScript
Option Explicit

Dim objWMIService, objDrive, colDrives
Dim strComputer, strDriveType
Dim dblTotalSpace, dblFreeSpace, dblUsedSpace, dblUsePercent

strComputer = "."

' WMI サービスに接続するためのオブジェクトを取得
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")

' ディスクドライブの情報を取得するためのコレクションをセット
Set colDrives = objWMIService.ExecQuery("SELECT [ ac acpi_listen addr2line alias amazon-ssm-agent apropos apropos.man-db ar arch arpaname arping as at atq atrm attr audit2allow audit2why aulast aulastlog ausyscall auvirt awk aws aws.cmd aws_bash_completer aws_completer aws_zsh_completer.sh b2sum base32 base64 basename basenc bash bashbug bashbug-64 batch bc bg bootctl bunzip2 busctl bzcat bzcmp bzdiff bzegrep bzfgrep bzgrep bzip2 bzip2recover bzless bzmore c++filt c89 c99 ca-legacy cal captoinfo cat catchsegv catman cc cd centrino-decode cfn-elect-cmd-leader cfn-get-metadata cfn-hup cfn-init cfn-send-cmd-event cfn-send-cmd-result cfn-signal chacl chage chardetect chattr chcat chcon checkmodule checkpolicy chevron chgrp chmem chmod choom chown chronyc chrt chvt cifsiostat cksum clear clockdiff cloud-id cloud-init cloud-init-per cmp col colcrt colrm column comm command containerd containerd-shim containerd-shim-runc-v1 containerd-shim-runc-v2 coredumpctl cp cpio cpp cpupower cronnext crontab csh csplit ctr curl cut cvtsudoers cyrusbdb2current date dbus-broker dbus-broker-launch dc dd deallocvt debuginfod-find delv df diff diff3 dig dir dircolors dirname distro dmesg dnf dnf-3 dnsdomainname dnstap-read docker docker-containerd docker-containerd-shim docker-ctr docker-init docker-proxy docker-runc dockerd domainname dracut du dumpkeys dwz ec2-metadata echo ed efisecdb efivar egrep eject elfedit encguess env envsubst eqn ex expand expr factor fallocate false fc fg fgconsole fgrep file fincore find findmnt fips-finish-install fips-mode-setup flock fmt fold free funzip fuse2fs gapplication gawk gcc gcc-ar gcc-nm gcc-ranlib gcov gcov-dump gcov-tool gdbus gencat geqn getconf getent getfacl getfattr getkeycodes getopt getopts gettext gettext.sh gio gio-querymodules-64 git git-receive-pack git-shell git-upload-archive git-upload-pack glib-compile-schemas gmake gneqn gnroff gpasswd gpg gpg-error gpg2 gpgme-json gpgv2 gpic gprof grep groff grops grotty groups growpart grub2-amazon-setup grub2-editenv grub2-file grub2-menulst2cfg grub2-mkimage grub2-mkpasswd-pbkdf2 grub2-mkrelpath grub2-mount grub2-script-check gsettings gsoelim gtar gtbl gtroff guild2.2 guile-tools2.2 guile2.2 gunzip gzexe gzip hardlink hash head hexdump hibinit-agent homectl host hostid hostname hostnamectl hunspell i386 iconv id info infocmp infotocap install ionice iostat ipcmk ipcrm ipcs irqtop isosize jobs join journalctl jp.py jq jsondiff jsondiff-3 jsondiff-3.9 jsonpatch jsonpatch-3 jsonpatch-3.9 jsonpointer jsonpointer-3 jsonpointer-3.9 jsonschema kbd_mode kbdinfo kbdrate kernel-install keyctl kill killall kmod last lastb lastcomm lastlog lchfn lchsh ld ld.bfd ld.so ldd less lessecho lesskey lesspipe.sh lexgrog link linux-boot-prober linux32 linux64 ln loadkeys loadunimap locale localectl localedef logger login loginctl logname look ls lsattr lsblk lscpu lsinitrd lsipc lsirq lslocks lslogins lsmcli lsmd lsmem lsns lsof lto-dump make make-dummy-cert man man-recode man.man-db mandb manpath mapscrn mcookie md5sum mesg miniterm-3.9.py miniterm-3.py miniterm.py mkdir mkfifo mknod mktemp mmdblookup modulemd-validator more mount mountpoint mpstat msgattrib msgcat msgcmp msgcomm msgconv msgen msgexec msgfilter msgfmt msggrep msginit msgmerge msgunfmt msguniq mv namei nano ncurses6-config ncursesw6-config neqn netstat networkctl newgidmap newgrp newuidmap ngettext nice nisdomainname nl nm node node-18 nohup npm npm-18 nproc npx npx-18 nroff nsenter nslookup nsupdate numfmt objcopy objdump od oomctl openssl openvt os-prober p11-kit passwd paste pathchk peekfd perl perl5.32.1 perldoc pgrep pic piconv pidof pidstat pidwait pigz ping pinky pkg-config pkgconf pkill pldd pmap pod2man pod2text pod2usage portablectl post-grohtml powernow-k8-decode pr pre-grohtml preconv printenv printf prlimit prtstat ps psfaddtable psfgettable psfstriptable psfxtable pslog pstree pstree.x11 ptx pwd pwdx pwmake pwscore pydoc pydoc3 pydoc3.9 python3 python3.9 pzstd quota quotasync ranlib read readelf readlink realpath recode-sr-latin red rename renew-dummy-cert renice reset resizecons resolvectl rev rm rmdir rnano rngtest rpcbind rpcinfo rpm rpm2archive rpm2cpio rpmdb rpmkeys rpmquery rpmverify rst2html rst2html4 rst2html5 rst2latex rst2man rst2odt rst2odt_prepstyles rst2pseudoxml rst2s5 rst2xetex rst2xml rstpep2html rsync rsync-ssl run-parts runcon rvi rview rvim sadf sar sbattach sbkeysync sbsiglist sbsign sbvarsign sbverify scalar scp screen script scriptlive scriptreplay sdiff secon sed sedismod sedispol semodule_expand semodule_link semodule_package semodule_unpackage seq sestatus setarch setfacl setfattr setfont setkeycodes setleds setmetamode setpriv setsid setterm setup-nsssysinit setup-nsssysinit.sh setup-policy-routes setvtrgb sftp sg sh sha1hmac sha1sum sha224hmac sha224sum sha256hmac sha256sum sha384hmac sha384sum sha512hmac sha512sum showconsolefont showkey shred shuf sim_lsmplugin simc_lsmplugin size skill slabtop sleep sm3hmac snice soelim soelim.groff sort sotruss split sprof sqlite3 ssh ssh-add ssh-agent ssh-copy-id ssh-keygen ssh-keyscan ssm-agent-worker ssm-cli ssm-document-worker ssm-session-logger ssm-session-worker sss_ssh_authorizedkeys sss_ssh_knownhostsproxy stap-merge stap-report stapbpf stapdyn staprun stapsh stat stdbuf strace strace-log-merge strings strip stty su sudo sudoedit sudoreplay sum sync systemctl systemd-analyze systemd-ask-password systemd-cat systemd-cgls systemd-cgtop systemd-creds systemd-cryptenroll systemd-delta systemd-detect-virt systemd-dissect systemd-escape systemd-firstboot systemd-hwdb systemd-id128 systemd-inhibit systemd-machine-id-setup systemd-mount systemd-notify systemd-path systemd-repart systemd-resolve systemd-run systemd-socket-activate systemd-stdio-bridge systemd-sysext systemd-sysusers systemd-tmpfiles systemd-tty-ask-password-agent systemd-umount tabs tac tail tapestat tar taskset tbl tcptraceroute tcsh tee test tic time timedatectl timeout tload toe top touch tput tr tracepath traceroute traceroute6 troff true truncate trust tset tsort tty turbostat type tzselect uclampset udevadm ul ulimit umask umount unalias uname uname26 unexpand unicode_start unicode_stop uniq unlink unpigz unshare unxz unzip unzipsfx unzstd update-ca-trust update-crypto-policies uptime userdbctl users usleep utmpdump uuidgen uuidparse vdir vi view vim vimdiff vimtutor vlock vmstat w wait wall watch wc wdctl wget whatis whatis.man-db whereis which whiptail who whoami write x86_64 x86_64-amazon-linux-gcc x86_64-amazon-linux-gcc-11 x86_64-amazon-linux-gnu-pkg-config x86_energy_perf_policy xargs xgettext xmlcatalog xmllint xmlwf xxd xz xzcat xzcmp xzdec xzdiff xzegrep xzfgrep xzgrep xzless xzmore yes ypdomainname yum zcat zcmp zdiff zdump zegrep zfgrep zforce zgrep zip zipcloak zipgrep zipinfo zipnote zipsplit zless zmore znew zsoelim zstd zstdcat zstdgrep zstdless zstdmt FROM Win32_LogicalDisk WHERE DriveType = 3")

' 各ディスクドライブの情報を取得し、計算して出力する
For Each objDrive In colDrives
 strDriveType = ""
 Select Case objDrive.DriveType
 Case 2
 strDriveType = "Removable Drive"
 Case 3
 strDriveType = "Local Disk"
 Case 4
 strDriveType = "Network Drive"
 Case 5
 strDriveType = "Compact Disc"
 Case 6
 strDriveType = "RAM Disk"
 End Select

 dblTotalSpace = objDrive.Size / 1024 / 1024 / 1024 ' GB に変換
 dblFreeSpace = objDrive.FreeSpace / 1024 / 1024 / 1024 ' GB に変換
 dblUsedSpace = dblTotalSpace - dblFreeSpace
 dblUsePercent = (dblUsedSpace / dblTotalSpace) [ ac acpi_listen addr2line alias amazon-ssm-agent apropos apropos.man-db ar arch arpaname arping as at atq atrm attr audit2allow audit2why aulast aulastlog ausyscall auvirt awk aws aws.cmd aws_bash_completer aws_completer aws_zsh_completer.sh b2sum base32 base64 basename basenc bash bashbug bashbug-64 batch bc bg bootctl bunzip2 busctl bzcat bzcmp bzdiff bzegrep bzfgrep bzgrep bzip2 bzip2recover bzless bzmore c++filt c89 c99 ca-legacy cal captoinfo cat catchsegv catman cc cd centrino-decode cfn-elect-cmd-leader cfn-get-metadata cfn-hup cfn-init cfn-send-cmd-event cfn-send-cmd-result cfn-signal chacl chage chardetect chattr chcat chcon checkmodule checkpolicy chevron chgrp chmem chmod choom chown chronyc chrt chvt cifsiostat cksum clear clockdiff cloud-id cloud-init cloud-init-per cmp col colcrt colrm column comm command containerd containerd-shim containerd-shim-runc-v1 containerd-shim-runc-v2 coredumpctl cp cpio cpp cpupower cronnext crontab csh csplit ctr curl cut cvtsudoers cyrusbdb2current date dbus-broker dbus-broker-launch dc dd deallocvt debuginfod-find delv df diff diff3 dig dir dircolors dirname distro dmesg dnf dnf-3 dnsdomainname dnstap-read docker docker-containerd docker-containerd-shim docker-ctr docker-init docker-proxy docker-runc dockerd domainname dracut du dumpkeys dwz ec2-metadata echo ed efisecdb efivar egrep eject elfedit encguess env envsubst eqn ex expand expr factor fallocate false fc fg fgconsole fgrep file fincore find findmnt fips-finish-install fips-mode-setup flock fmt fold free funzip fuse2fs gapplication gawk gcc gcc-ar gcc-nm gcc-ranlib gcov gcov-dump gcov-tool gdbus gencat geqn getconf getent getfacl getfattr getkeycodes getopt getopts gettext gettext.sh gio gio-querymodules-64 git git-receive-pack git-shell git-upload-archive git-upload-pack glib-compile-schemas gmake gneqn gnroff gpasswd gpg gpg-error gpg2 gpgme-json gpgv2 gpic gprof grep groff grops grotty groups growpart grub2-amazon-setup grub2-editenv grub2-file grub2-menulst2cfg grub2-mkimage grub2-mkpasswd-pbkdf2 grub2-mkrelpath grub2-mount grub2-script-check gsettings gsoelim gtar gtbl gtroff guild2.2 guile-tools2.2 guile2.2 gunzip gzexe gzip hardlink hash head hexdump hibinit-agent homectl host hostid hostname hostnamectl hunspell i386 iconv id info infocmp infotocap install ionice iostat ipcmk ipcrm ipcs irqtop isosize jobs join journalctl jp.py jq jsondiff jsondiff-3 jsondiff-3.9 jsonpatch jsonpatch-3 jsonpatch-3.9 jsonpointer jsonpointer-3 jsonpointer-3.9 jsonschema kbd_mode kbdinfo kbdrate kernel-install keyctl kill killall kmod last lastb lastcomm lastlog lchfn lchsh ld ld.bfd ld.so ldd less lessecho lesskey lesspipe.sh lexgrog link linux-boot-prober linux32 linux64 ln loadkeys loadunimap locale localectl localedef logger login loginctl logname look ls lsattr lsblk lscpu lsinitrd lsipc lsirq lslocks lslogins lsmcli lsmd lsmem lsns lsof lto-dump make make-dummy-cert man man-recode man.man-db mandb manpath mapscrn mcookie md5sum mesg miniterm-3.9.py miniterm-3.py miniterm.py mkdir mkfifo mknod mktemp mmdblookup modulemd-validator more mount mountpoint mpstat msgattrib msgcat msgcmp msgcomm msgconv msgen msgexec msgfilter msgfmt msggrep msginit msgmerge msgunfmt msguniq mv namei nano ncurses6-config ncursesw6-config neqn netstat networkctl newgidmap newgrp newuidmap ngettext nice nisdomainname nl nm node node-18 nohup npm npm-18 nproc npx npx-18 nroff nsenter nslookup nsupdate numfmt objcopy objdump od oomctl openssl openvt os-prober p11-kit passwd paste pathchk peekfd perl perl5.32.1 perldoc pgrep pic piconv pidof pidstat pidwait pigz ping pinky pkg-config pkgconf pkill pldd pmap pod2man pod2text pod2usage portablectl post-grohtml powernow-k8-decode pr pre-grohtml preconv printenv printf prlimit prtstat ps psfaddtable psfgettable psfstriptable psfxtable pslog pstree pstree.x11 ptx pwd pwdx pwmake pwscore pydoc pydoc3 pydoc3.9 python3 python3.9 pzstd quota quotasync ranlib read readelf readlink realpath recode-sr-latin red rename renew-dummy-cert renice reset resizecons resolvectl rev rm rmdir rnano rngtest rpcbind rpcinfo rpm rpm2archive rpm2cpio rpmdb rpmkeys rpmquery rpmverify rst2html rst2html4 rst2html5 rst2latex rst2man rst2odt rst2odt_prepstyles rst2pseudoxml rst2s5 rst2xetex rst2xml rstpep2html rsync rsync-ssl run-parts runcon rvi rview rvim sadf sar sbattach sbkeysync sbsiglist sbsign sbvarsign sbverify scalar scp screen script scriptlive scriptreplay sdiff secon sed sedismod sedispol semodule_expand semodule_link semodule_package semodule_unpackage seq sestatus setarch setfacl setfattr setfont setkeycodes setleds setmetamode setpriv setsid setterm setup-nsssysinit setup-nsssysinit.sh setup-policy-routes setvtrgb sftp sg sh sha1hmac sha1sum sha224hmac sha224sum sha256hmac sha256sum sha384hmac sha384sum sha512hmac sha512sum showconsolefont showkey shred shuf sim_lsmplugin simc_lsmplugin size skill slabtop sleep sm3hmac snice soelim soelim.groff sort sotruss split sprof sqlite3 ssh ssh-add ssh-agent ssh-copy-id ssh-keygen ssh-keyscan ssm-agent-worker ssm-cli ssm-document-worker ssm-session-logger ssm-session-worker sss_ssh_authorizedkeys sss_ssh_knownhostsproxy stap-merge stap-report stapbpf stapdyn staprun stapsh stat stdbuf strace strace-log-merge strings strip stty su sudo sudoedit sudoreplay sum sync systemctl systemd-analyze systemd-ask-password systemd-cat systemd-cgls systemd-cgtop systemd-creds systemd-cryptenroll systemd-delta systemd-detect-virt systemd-dissect systemd-escape systemd-firstboot systemd-hwdb systemd-id128 systemd-inhibit systemd-machine-id-setup systemd-mount systemd-notify systemd-path systemd-repart systemd-resolve systemd-run systemd-socket-activate systemd-stdio-bridge systemd-sysext systemd-sysusers systemd-tmpfiles systemd-tty-ask-password-agent systemd-umount tabs tac tail tapestat tar taskset tbl tcptraceroute tcsh tee test tic time timedatectl timeout tload toe top touch tput tr tracepath traceroute traceroute6 troff true truncate trust tset tsort tty turbostat type tzselect uclampset udevadm ul ulimit umask umount unalias uname uname26 unexpand unicode_start unicode_stop uniq unlink unpigz unshare unxz unzip unzipsfx unzstd update-ca-trust update-crypto-policies uptime userdbctl users usleep utmpdump uuidgen uuidparse vdir vi view vim vimdiff vimtutor vlock vmstat w wait wall watch wc wdctl wget whatis whatis.man-db whereis which whiptail who whoami write x86_64 x86_64-amazon-linux-gcc x86_64-amazon-linux-gcc-11 x86_64-amazon-linux-gnu-pkg-config x86_energy_perf_policy xargs xgettext xmlcatalog xmllint xmlwf xxd xz xzcat xzcmp xzdec xzdiff xzegrep xzfgrep xzgrep xzless xzmore yes ypdomainname yum zcat zcmp zdiff zdump zegrep zfgrep zforce zgrep zip zipcloak zipgrep zipinfo zipnote zipsplit zless zmore znew zsoelim zstd zstdcat zstdgrep zstdless zstdmt 100

 WScript.Echo "Drive " & objDrive.DeviceID
 WScript.Echo "Type: " & strDriveType
 WScript.Echo "Total Size: " & Round(dblTotalSpace, 2) & " GB"
 WScript.Echo "Free Space: " & Round(dblFreeSpace, 2) & " GB"
 WScript.Echo "Used Space: " & Round(dblUsedSpace, 2) & " GB"
 WScript.Echo "Use Percentage: " & Round(dblUsePercent, 2) & " %"
 WScript.Echo "-----------------------------------"
Next

' オブジェクトの解放
Set objWMIService = Nothing
Set colDrives = Nothing
```

このコードは、Win32_LogicalDisk WMI クラスを使用してローカルディスクドライブ（DriveType = 3 がローカルディスク）のリストを取得し、各ドライブの容量と空き容量、使用容量、使用率を計算して出力しています。 容量はギガバイト (GB) 単位で表示されます。

スクリプトを実行すると、実行しているコンピュータ上の各ハードディスクドライブの詳細が出力されます。スクリプトを変更して、他の種類のドライブやさまざまな詳細を出力することも可能です。
