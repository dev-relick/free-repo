Oracleのexport処理でentry_d列が現在日付から3年前までのデータをエクスポートする。実行環境はWindows


Oracleデータベースで特定の条件に基づいたデータをエクスポートするためには、Oracle Data Pumpを使用するのが一般的です。Oracle Data Pumpは、expdpとimpdpツールを提供し、これを使ってデータをエクスポートおよびインポートします。

`expdp`ユーティリティは、QUERYパラメータを使用して特定の行のみをエクスポートすることができます。`entry_d`列があるテーブルに対して、現在日付から3年前までのデータのみをエクスポートするには次のようにします。

この例では、`YOUR_SCHEMA`はエクスポートするデータがあるスキーマ名、`YOUR_TABLE`は対象のテーブル名です。このコマンドを実行する前に、`expdp`が実行されるWindows環境でOracleの環境変数が適切に設定されていることを確認してください。

1. コマンドプロンプトを開きます。
2. Oracleの環境変数を設定します（必要に応じて）。
3. `expdp`コマンドを実行します。以下のコマンド例は、現在の日付から3年前までのデータをエクスポートします。

```cmd
expdp USERNAME/PASSWORD@DB_SERVICE_NAME DIRECTORY=EXPORT_DIR DUMPFILE=export_data.dmp LOGFILE=export_log.log TABLES=YOUR_SCHEMA.YOUR_TABLE QUERY=YOUR_SCHEMA.YOUR_TABLE:"WHERE entry_d >= ADD_MONTHS(SYSDATE, -36)"
```

- `USERNAME/PASSWORD`: Oracleデータベースのユーザー名とパスワード。
- `DB_SERVICE_NAME`: データベースのサービス名。
- `EXPORT_DIR`: Oracleデータベースで定義されているディレクトリの名前。OracleのDIRECTORYオブジェクトを事前に作成しておく必要があります。これはデータポンプが出力を書き出すためのディレクトリを指定します。
- `DUMPFILE`: エクスポートされるデータポンプ・ダンプファイルの名前。
- `LOGFILE`: エクスポート処理のログファイルの名前。
- `TABLES`: エクスポートするテーブルを指定します。
- `QUERY`: 対象となるテーブルデータを抽出するための条件を指定します。

日付に関連する部分では、`SYSDATE`を使用して現在の日付を取得し、`ADD_MONTHS`関数を使用してそれから36ヶ月（3年）前の日付を求めています。`entry_d`が日付型の列であれば、この条件は該当する範囲のデータのみをエクスポートします。

**注意点**:
- `DIRECTORY`パラメータで指定するディレクトリは、Oracleデータベースによって認識されるサーバー上のパスである必要があり、事前にDBAによって作成される必要があります。
- 実際のユーザ名、パスワード、ディレクトリ名、ファイル名などは、あなたの環境によって異なりますので、それに合わせて適宜変更してください。
- Oracleのバージョンや環境によっては利用できる機能やパラメータが異なる場合があるため、常にOracleの公式ドキュメントやオンラインリソースを参照することをおすすめします。
