Oracleのexport処理でentry_d列が現在日付から3年前までのデータをエクスポートする。実行環境はWindows


Oracle Databaseで特定の列の値に基づいてデータをエクスポートするには、Data Pump Export (`expdp`) を利用することが一般的です。`expdp` は、Oracle データベースの高度なエクスポートツールで、テーブルをエクスポートする際にクエリオプションを使って特定の行を抽出することができます。

以下は、`entry_d` 列が現在の日付から3年前までのデータをエクスポートするコマンドの例です。このコマンドを実行するためには、まずコマンドプロンプトを開き、OracleのData Pumpディレクトリを指定した上で `expdp` コマンドを実行します。

```cmd
expdp username/password DIRECTORY=export_dir DUMPFILE=export_data.dmp TABLES=your_schema.your_table QUERY=your_schema.your_table:\"WHERE entry_d >= TO_DATE\(\'$(date -d \'-3 years\' +%Y-%m-%d)\', \'YYYY-MM-DD\'\) AND entry_d <= SYSDATE\"
```

ここで、次の要素に注意してください：

- `username/password`: 空白を含むデータベースのユーザ名とパスワードに置き換えます。
- `export_dir`: 事前に作成したOracle Data Pumpのディレクトリ名に置き換えます。
- `export_data.dmp`: エクスポートファイルの名前を指定します。
- `your_schema.your_table`: エクスポートしたいスキーマとテーブル名に置き換えます。

上記の `$(date -d '-3 years' +%Y-%m-%d)` 部分は、Unix/Linux シェルの構文で、Windows バッチファイルで使用するには適していません。Windows で現在の日付から3年前の日付を取得するためには、PowerShell や VBScript を使用するか、SQL内で計算する必要があります。

ここでは、SQL内で計算を行う方法を示します：

```cmd
expdp username/password DIRECTORY=export_dir DUMPFILE=export_data.dmp TABLES=your_schema.your_table QUERY=your_schema.your_table:\"WHERE entry_d >= ADD_MONTHS\(SYSDATE, -36\) AND entry_d < SYSDATE\"
```

このクエリでは `ADD_MONTHS(SYSDATE, -36)` 関数を使用して現在の日付から36ヶ月（3年）前の日付を計算しています。

これで、`entry_d` 列が直近3年のデータのみを含む `your_table` をエクスポートするためのコマンドが完成しました。このコマンドを実行する前に、適切なユーザ権限とData Pumpディレクトリの設定が必要です。権限やディレクトリ設定については、Oracle DatabaseのドキュメントやDBAに相談してください。
